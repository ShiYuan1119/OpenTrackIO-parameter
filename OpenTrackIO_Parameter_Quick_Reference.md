# OpenTrackIO 参数快速参考

## 参数分类表

### 静态参数 (Static)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 持续时间 | `duration` | 有理数 | 秒 | > 0 | ❌ |
| 捕获帧率 | `captureFrameRate` | 有理数 | Hz | > 0 | ❌ |
| 传感器物理尺寸 | `activeSensorPhysicalDimensions` | 对象 | mm | ≥ 0 | ❌ |
| 传感器分辨率 | `activeSensorResolution` | 对象 | 像素 | [0, 2³¹-1] | ❌ |
| 相机制造商 | `make` | 字符串 | - | 1-1023 字符 | ❌ |
| 相机型号 | `model` | 字符串 | - | 1-1023 字符 | ❌ |
| 序列号 | `serialNumber` | 字符串 | - | 1-1023 字符 | ❌ |
| 固件版本 | `firmwareVersion` | 字符串 | - | 1-1023 字符 | ❌ |
| 相机标签 | `label` | 字符串 | - | 1-1023 字符 | ❌ |
| 变形压缩比 | `anamorphicSqueeze` | 有理数 | - | > 0 | ❌ |
| ISO 感光度 | `isoSpeed` | 整数 | - | > 0 | ❌ |
| FDL 链接 | `fdlLink` | UUID URN | - | 有效 UUID | ❌ |
| 快门角度 | `shutterAngle` | 实数 | 度 | (0, 360] | ❌ |

### 跟踪器参数 (Tracker)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 备注 | `notes` | 字符串 | - | 1-1023 字符 | ❌ |
| 录制状态 | `recording` | 布尔 | - | true/false | ❌ |
| 场记板 | `slate` | 字符串 | - | 1-1023 字符 | ❌ |
| 状态 | `status` | 字符串 | - | 1-1023 字符 | ❌ |

### 时间参数 (Timing)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 时间模式 | `mode` | 枚举 | - | internal/external | ❌ |
| 录制时间戳 | `recordedTimestamp` | 对象 | 秒 | 48位秒+32位纳秒 | ❌ |
| 采样率 | `sampleRate` | 有理数 | Hz | > 0 | ❌ |
| 样本时间戳 | `sampleTimestamp` | 对象 | 秒 | 48位秒+32位纳秒 | ❌ |
| 序列号 | `sequenceNumber` | 整数 | - | ≥ 0 | ❌ |
| 同步信息 | `synchronization` | 对象 | - | 复杂对象 | ❌ |
| 时间码 | `timecode` | 对象 | - | SMPTE 格式 | ❌ |

### 镜头参数 (Lens)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 自定义系数 | `custom` | 数组 | - | 浮点数数组 | ❌ |
| 畸变参数 | `distortion` | 数组 | - | 畸变对象数组 | ❌ |
| 畸变偏移 | `distortionOffset` | 对象 | mm | 实数 | ❌ |
| 编码器位置 | `encoders` | 对象 | - | [0, 1] | ❌ |
| 入瞳偏移 | `entrancePupilOffset` | 实数 | 米 | 实数 | ❌ |
| 曝光衰减 | `exposureFalloff` | 对象 | - | 实数系数 | ❌ |
| F 值 | `fStop` | 实数 | - | > 0 | ❌ |
| 针孔焦距 | `pinholeFocalLength` | 实数 | mm | > 0 | ❌ |
| 对焦距离 | `focusDistance` | 实数 | 米 | > 0 | ❌ |
| 投影偏移 | `projectionOffset` | 对象 | mm | 实数 | ❌ |
| 原始编码器 | `rawEncoders` | 对象 | - | ≥ 0 | ❌ |
| T 值 | `tStop` | 实数 | - | > 0 | ❌ |

### 协议标识 (Protocol)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 协议名称 | `name` | 字符串 | - | "OpenTrackIO" | ✅ |
| 协议版本 | `version` | 数组 | - | [主,次,修订] | ✅ |

### 变换参数 (Transforms)

| 参数 | JSON 键名 | 类型 | 单位 | 范围/约束 | 必需 |
|-----|----------|------|------|-----------|------|
| 平移 | `translation` | 对象 | 米 | 实数 | ✅ |
| 旋转 | `rotation` | 对象 | 度 | 实数 | ✅ |
| 缩放 | `scale` | 对象 | - | 实数 | ❌ |
| 标识符 | `id` | 字符串 | - | 1-1023 字符 | ❌ |

---

## 数据采样类型

### Static (静态)
- **定义**: 整个片段期间保持不变的参数
- **示例**: 相机型号、镜头序列号、传感器尺寸
- **存储**: 在 `static` 对象中

### Regular (常规)
- **定义**: 每个样本都可能变化的参数
- **示例**: 相机位置、镜头对焦、跟踪器状态
- **存储**: 在主对象中，以数组形式

---

## 单位系统

| 物理量 | 单位 | 符号 | 说明 |
|-------|------|------|------|
| 长度 | 米 | m | 空间坐标、距离 |
| 长度 | 毫米 | mm | 镜头参数、偏移 |
| 角度 | 度 | ° | 旋转、快门角度 |
| 时间 | 秒 | s | 时间戳、持续时间 |
| 频率 | 赫兹 | Hz | 帧率、采样率 |
| 分辨率 | 像素 | px | 图像尺寸 |

---

## 常用枚举值

### TimingMode
- `"internal"`: 内部时间模式
- `"external"`: 外部时间模式

### SynchronizationSource
- `"genlock"`: 同步锁定
- `"videoIn"`: 视频输入
- `"ptp"`: 精确时间协议
- `"ntp"`: 网络时间协议

### PTPProfile
- `"IEEE Std 1588-2019"`: IEEE 标准
- `"IEEE Std 802.1AS-2020"`: 音视频桥接
- `"SMPTE ST2059-2:2021"`: SMPTE 标准

### PTPLeaderTimeSource
- `"GNSS"`: 全球导航卫星系统
- `"Atomic clock"`: 原子钟
- `"NTP"`: 网络时间协议

### DistortionModel
- `"Brown-Conrady D-U"`: 畸变到未畸变
- `"Brown-Conrady U-D"`: 未畸变到畸变

---

## 验证检查清单

### 数据完整性
- [ ] 协议名称和版本正确
- [ ] 必需字段存在
- [ ] 数据类型匹配
- [ ] 数值范围有效

### 逻辑一致性
- [ ] 时间戳递增
- [ ] 帧数小于帧率
- [ ] 编码器值在有效范围
- [ ] UUID 格式正确

### 性能检查
- [ ] 数据大小合理
- [ ] 采样率适当
- [ ] 网络带宽充足
- [ ] 处理延迟可接受

---

## 故障排除

### 解析错误
```
ValidationError: 1 validation error for Clip
lens.fStop.0
  Input should be greater than 0
```

**解决**: 检查 fStop 值是否为正数

### 时间同步问题
```
Warning: PTP synchronization lost
```

**解决**: 检查网络连接和 PTP 配置

### 畸变参数错误
```
ValueError: radial distortion coefficient sequence must not be empty
```

**解决**: 确保径向畸变系数数组不为空

---

## 最佳实践摘要

1. **使用有理数**: 精确表示帧率和时间
2. **验证输入**: 始终验证接收的数据
3. **处理可选字段**: 优雅处理缺失数据
4. **版本检查**: 确保协议版本兼容
5. **单位一致**: 严格遵循单位约定
6. **性能监控**: 监控解析和传输性能
7. **错误处理**: 实现完善的错误恢复机制

---

*快速参考手册版本: 1.0.0*